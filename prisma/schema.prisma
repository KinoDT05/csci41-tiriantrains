enum Gender_enum {
  Male
  Female
  Others
}

enum Train_Type_enum {
  A
  S
}

enum Location_enum {
  Intertown
  WestWood
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("PRISMA_DATABASE_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL") // uses a direct connection
}

model User {
  customerID Int         @id @default(autoincrement())
  email String @unique
  givenName String
  lastName  String
  password String        @default("TestPassword")
  birthDate DateTime 
  tickets Ticket[]
  @@map(name: "users")
}

model TrainModel {
  modelID             String             @id
  maxSpeed            Int             @default(0)
  noSeats             Int             @default(100)
  noToilets           Int             @default(0)
  hasRecliningSeats   Boolean         @default(false)
  hasFoldingTables    Boolean         @default(false)
  hasDisabilityAccess Boolean         @default(false)
  hasLuggageStorage   Boolean         @default(false)
  hasVendingMachines  Boolean         @default(false)
  hasFoodService      Boolean         @default(false)
  trains              Train[]
}

model Train {
  trainID              Int                  @id @unique @default(autoincrement())
  trainType           Train_Type_enum
  trainModelID         String
  trainModel           TrainModel           @relation(fields: [trainModelID], references: [modelID])
  maintenanceHistories MaintenanceHistory[]
  schedules Schedule[]
}

model Crew {
  crewName             String               @id
  inCharge             String
  maintenanceHistories MaintenanceHistory[]
}

model MaintenanceHistory {
  maintenanceID		Int		@id @default(autoincrement())
  date              DateTime
  maintainedTrainID Int
  maintainer        String
  task              String
  condition         String @default(" ")
  crewAssigned      Crew     @relation(fields: [maintainer], references: [crewName])
  trainMaintained   Train    @relation(fields: [maintainedTrainID], references: [trainID])
}

model Station {
   stationName String @id
   locationList Location_enum[]
   originRoutes        Route[]  @relation("OriginRelation")
   destinationRoutes   Route[]  @relation("DestinationRelation")
}

model Route {
   originID String
   originStation Station @relation("OriginRelation" ,fields: [originID], references:[stationName])

   destinationID String
   destinationStation Station @relation("DestinationRelation", fields:[destinationID], references: [stationName])

   durationInMinutes Int @default(5)
   cost Int  @default(2) 

   schedules Schedule[]

   @@id([originID, destinationID])
}

model Schedule {
   scheduleID Int @id @default(autoincrement())

   originID String
   destinationID String
   route Route @relation(fields: [originID, destinationID], references: [originID, destinationID])

   trainID Int
   trainInTransit Train @relation(fields:[trainID], references:[trainID])

   departure DateTime
   Arrival DateTime?

   itinerary Itinerary[]
}


model Ticket {
   ticketID Int @id @default(autoincrement())
   
   customerID Int
   customer User @relation(fields:[customerID], references: [customerID])

   itinerary Itinerary[]
}

model Itinerary {
   itineraryID Int @id @default(autoincrement())

   scheduleID Int
   schedule Schedule @relation(fields:[scheduleID], references:[scheduleID])

   ticketID Int
   ticket Ticket @relation(fields:[ticketID], references:[ticketID])
}
